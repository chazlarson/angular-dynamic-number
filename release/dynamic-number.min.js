/*jslint node: true */
!function(n,e){"use strict"
if("function"==typeof define&&define.amd)define(["angular"],e)
else{if("undefined"==typeof module||"object"!=typeof module.exports)return e(n.angular)
module.exports=e(require("angular"))}}(window,function(n){"use strict"
function e(n,e,r,t){if(void 0===n||null===n||""===n)return 0
var u=""
return u=","===e?String(n).replace(".",","):String(n)}function r(n,e,r){return","===e?String(n).replace(/['\.\s]/g,"").replace(",","."):"."===e?String(n).replace(/[',\s]/g,""):void 0}function t(n,e,r){var t=n
return r&&(t+=r),e&&(t=/^\-.+/.test(t)?t.replace("-","-"+e):/^\-/.test(t)?t:e+t),t}function u(n,e){if(n>=0){var r=parseInt(n,10)
if(isNaN(r)===!1&&isFinite(r)&&r>=0)return r}return e}function a(n,e){if(n>=0){var r=parseInt(n,10)
if(isNaN(r)===!1&&isFinite(r)&&r>=0)return r}return e}function i(n,e){return","===n?",":"."===n?".":e}function o(n,e){return"false"!==n&&n!==!1&&("true"===n||n===!0||e)}function m(n,e){return"false"!==n&&n!==!1&&("true"===n||n===!0||e)}function c(n,e){return"floor"===n?Math.floor:"ceil"===n?Math.ceil:"round"===n?Math.round:e}function d(n,e){return"false"!==n&&n!==!1&&("true"===n||n===!0||e)}function p(n,e){if(n>=0){var r=Number(n)
if(isNaN(r)===!1&&isFinite(r)&&r>=-Number.MAX_VALUE)return r}return e}function s(n,e){if(n<=Number.MAX_VALUE){var r=Number(n)
if(isNaN(r)===!1&&isFinite(r)&&r<=Number.MAX_VALUE)return r}return e}function f(n,e){return"false"!==n&&n!==!1&&("true"===n||n===!0||e)}function l(n,e,r){if(!n)return r
var t
return t="."===e?new RegExp("^[',\\s]$"):new RegExp("^['\\.\\s]$"),t.test(n)?n:r}function g(n){var e=new RegExp("[^\\d,\\.\\s\\-]{1}")
return e.test(n)?n:null}function v(n,e,r,t,u){var a="-?"
t===!1&&u===!0?a="-":t===!0&&u===!1&&(a="")
var i="[0-9]{0,"+n+"}"
0===n&&(i="0")
var o="(\\"+r+"([0-9]){0,"+e+"})"
return 0===e&&(o=""),new RegExp("^"+a+i+o+"?$")}function S(n){return String(n).replace(/^0+/g,"").replace(/^-0(\d+)/g,"-$1").replace(new RegExp("^-([\\.,\\s])","g"),"-0$1").replace(new RegExp("^[\\.,\\s]","g"),"0$&")}function h(n,e,r){var t=n
return e&&(t=t.replace(new RegExp("[\\"+e+"]","g"),"")),r&&(t=t.replace(new RegExp("[\\"+r+"]","g"),"")),t}function x(n,e){return"."===e?String(n).replace(/\./g,""):","===e?String(n).replace(/,/g,""):String(n).replace(new RegExp("['\\s]","g"),"")}function w(n,e,r){return n=String(n).split(e),n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,r),n.join(e)}function N(n,e){var r=n
if(e.isFixed){var t=r.split(e.fractionSeparator)[1],u=t&&t.length?t.length:0
0===u&&(r+=e.fractionSeparator)
for(var a=u;a<e.fractionPart;a++)r+="0"}return r}function M(e,r,u,a,i){i&&(a.enable=!1)
var o=String(r),m=N(o,u),c=t(m,u.prepend,u.append),d=n.version
1===d.major&&2===d.minor?e.$viewValue=c:e.$setViewValue(c),e.$render()}function b(n,r,u,a,i,o,m,c,d){if(""===n||void 0===n||null===n)return""
if(n=Number(n),!isNaN(n)&&isFinite(n)){var p=Math.pow(10,r)
return n=i?e((a(n*p)/p).toFixed(r),u,c,d):e(String(a(n*p)/p),u,c,d),n=t(n,c,d),o&&(n=w(n,u,m)),n}return i?(0).toFixed(r):"0"}function $(n){var e=0
if(document.selection){n.focus()
var r=document.selection.createRange()
r.moveStart("character",-n.value.length),e=r.text.length}else(n.selectionStart||"0"==n.selectionStart)&&(e="backward"==n.selectionDirection?n.selectionStart:n.selectionEnd)
return e}function F(n,e){if(null!==n)if(n.createTextRange){var r=n.createTextRange()
r.move("character",e),r.select()}else n.selectionStart?(n.focus(),n.setSelectionRange(e,e)):n.focus()}function A(n,e,r){for(var t=0,u=0,a=0;a<n.length;a++)if(n[a]!==e){if(t++,t>=r)break}else u++
return u}function P(n,e){var r=n,t=r.split(e.fractionSeparator),u=t[0],a=t[1]
return a&&a.length>e.fractionPart&&(a=a.slice(0,e.fractionPart),r=[u,a].join(e.fractionSeparator)),r}function R(n){return Number(n)}function E(n,e,r){var t={awnum:n.awnum,numInt:n.numInt,numFract:n.numFract,numSep:n.numSep,numPos:n.numPos,numNeg:n.numNeg,numRound:n.numRound,numThousand:n.numThousand,numThousandSep:n.numThousandSep,numPrepend:n.numPrepend,numAppend:n.numAppend,numFixed:n.numFixed,numMax:n.numMax,numMin:n.numMin}
return e&&(t[e]=r),t}function T(n,e){return n.replace(new RegExp("[\\"+e.fractionSeparator+"]+","g"),e.fractionSeparator)}function y(n,e,r,t,S){var h={}
n.awnum&&(h=S.getStrategy(n.awnum))
var x=u(void 0!==n.numInt?n.numInt:h.numInt,6),w=a(void 0!==n.numFract?n.numFract:h.numFract,2),N=i(void 0!==n.numSep?n.numSep:h.numSep,"."),M=o(void 0!==n.numPos?n.numPos:h.numPos,!0),b=m(void 0!==n.numNeg?n.numNeg:h.numNeg,!0),$=c(void 0!==n.numRound?n.numRound:h.numRound,Math.round),F=f(void 0!==n.numThousand?n.numThousand:h.numThousand,!1),A=l(void 0!==n.numThousandSep?n.numThousandSep:h.numThousandSep,N,"."===N?",":"."),P=g(void 0!==n.numPrepend?n.numPrepend:h.numPrepend),R=g(void 0!==n.numAppend?n.numAppend:h.numAppend),E=d(void 0!==n.numFixed?n.numFixed:h.numFixed,!1),T=p(void 0!==n.numMax?n.numMax:h.numMax,Number.MAX_VALUE),y=s(void 0!==n.numMin?n.numMin:h.numMin,-Number.MAX_VALUE)
if(M===!1&&b===!1)throw new Error("Number is set to not be positive and not be negative. Change num_pos attr or/and num_neg attr to true")
var V=v(x,w,N,M,b)
return{element:e,attrs:r,ngModelController:t,viewRegexTest:V,integerPart:x,fractionPart:w,fractionSeparator:N,isPositiveNumber:M,isNegativeNumber:b,roundFunction:$,isThousandSeparator:F,thousandSeparator:A,prepend:P,append:R,isFixed:E,numMax:T,numMin:y}}function V(n,t,u){var a=t.element,i=(t.attrs,t.ngModelController),o=t.viewRegexTest,m=(t.integerPart,t.fractionPart),c=t.fractionSeparator,d=t.isPositiveNumber,p=t.isNegativeNumber,s=(t.roundFunction,t.isThousandSeparator),f=t.thousandSeparator,l=t.prepend,g=t.append,v=(t.isFixed,t.numMax),N=t.numMin,b=isNaN(Number(n))
b||(n>v&&(n=v),n<N&&(n=N))
var R=String(n)
if(L){L=!1
var E=new RegExp("[^"+(p?"-":"")+c+f+"0-9]+","g")
R=R.replace(E,""),E=new RegExp("^["+c+f+"]"),R=R.replace(E,""),E=new RegExp("["+c+f+"]([0-9]{"+m+"})$"),R=R.replace(E,c+"$1")}if(R=h(R,l,g),R=T(R,t),new RegExp("^[.,"+f+"]{2,}").test(R))return M(i,0,t,u),0
var y=$(a[0])
l&&y--
var V=R.slice(0,y)
V=x(V,f),R=x(R,f),V=S(V)
var I=R
if(R=S(R),R==="0"+c&&I===c&&d)return m?(M(i,"0"+c,t,u,!0),F(a[0],2),0):(M(i,"",t,u),0)
if(""===R&&"0"===String(n).charAt(0))return M(i,0,t),0
if(void 0===R||""===R)return 0
if("-"===R)return d&&!p?M(i,"",t,u):M(i,"-",t,u),0
if(R=P(R,t),o.test(R)===!1){var _=e(i.$modelValue,c,t)
return s&&(_=w(_,c,f)),M(i,_,t,u),F(a[0],y-1),i.$modelValue}var U=0,X=V.length
return s&&(R=w(R,c,f),U=A(R,f,X)),l&&(U++,new RegExp("^(\\-\\d)$").test(R)&&(U+=2),new RegExp("^(\\d)$").test(R)&&U++),M(i,R,t,u),F(a[0],X+U),r(R,c,f)}function I(n,e){n.$setViewValue(""),n.$render(),n.$setViewValue(e),n.$render()}function _(n,e){var r=b(n.$modelValue,e.fractionPart,e.fractionSeparator,e.roundFunction,e.isFixed,e.isThousandSeparator,e.thousandSeparator,e.prepend,e.append,e.numMax,e.numMin)
I(n,r)}function U(n){return{restrict:"A",require:"?ngModel",scope:{awnum:"@",numInt:"@",numFract:"@",numSep:"@",numPos:"@",numNeg:"@",numRound:"@",numThousand:"@",numThousandSep:"@",numPrepend:"@",numAppend:"@",numFixed:"@",numMax:"@",numMin:"@"},link:function(e,r,t,u){if(!r[0]||"INPUT"!==r[0].tagName||"text"!==r[0].type&&"tel"!==r[0].type)return void console.warn("Directive angular-dynamic-number works only for 'input' tag with type = 'text' or type = 'tel'")
if(!u)return void console.warn("Directive angular-dynamic-number need ngModel attribute")
var a=y(E(e),r,t,u,n)
r.on("paste",function(){L=!0}),e.$watch("numInt",function(i,o){o!==i&&(a=y(E(e,"numInt",i),r,t,u,n),_(u,a))}),e.$watch("numFract",function(i,o){o!==i&&(a=y(E(e,"numFract",i),r,t,u,n),_(u,a))}),e.$watch("numSep",function(i,o){o!==i&&(a=y(E(e,"numSep",i),r,t,u,n),_(u,a))}),e.$watch("numPos",function(i,o){o!==i&&(a=y(E(e,"numPos",i),r,t,u,n),_(u,a))}),e.$watch("numNeg",function(i,o){o!==i&&(a=y(E(e,"numNeg",i),r,t,u,n),_(u,a))}),e.$watch("numThousand",function(i,o){o!==i&&(a=y(E(e,"numThousand",i),r,t,u,n),_(u,a))}),e.$watch("numThousandSep",function(i,o){o!==i&&(a=y(E(e,"numThousandSep",i),r,t,u,n),_(u,a))}),e.$watch("numAppend",function(i,o){o!==i&&(a=y(E(e,"numAppend",i),r,t,u,n),_(u,a))}),e.$watch("numPrepend",function(i,o){o!==i&&(a=y(E(e,"numPrepend",i),r,t,u,n),_(u,a))}),e.$watch("numFixed",function(i,o){o!==i&&(a=y(E(e,"numFixed",i),r,t,u,n),_(u,a))}),e.$watch("numMax",function(i,o){o!==i&&(a=y(E(e,"numMax",i),r,t,u,n),_(u,a))}),e.$watch("numMin",function(i,o){o!==i&&(a=y(E(e,"numMin",i),r,t,u,n),_(u,a))})
var i={enable:!0,count:0}
u.$parsers.unshift(function(n){return i.enable?(i.count++,R(V(n,a,i))):(i.enable=!0,n)}),u.$formatters.push(function(n){return b(n,a.fractionPart,a.fractionSeparator,a.roundFunction,a.isFixed,a.isThousandSeparator,a.thousandSeparator,a.prepend,a.append)})}}}var L=!1,X="dynamicNumber"
return n.module(X,[]).provider("dynamicNumberStrategy",function(){var n={}
this.addStrategy=function(e,r){n[e]=r},this.getStrategy=function(e){return n[e]},this.$get=function(){return{getStrategy:function(e){return n[e]}}}}).filter("awnum",["dynamicNumberStrategy",function(e){return function(r,t,u,o,m,v,S,h,x,w,N){var M,$={}
n.isString(t)&&($=e.getStrategy(t),t=$.numFract)
var M=a(t,2),F=i(void 0!==u?u:$.numSep,"."),A=c(void 0!==o?o:$.numRound,Math.round),P=d(void 0!==m?m:$.numFixed,!1),w=p(void 0!==w?w:$.numMax,Number.MAX_VALUE),N=s(void 0!==N?N:$.numMin,-Number.MAX_VALUE)
w<=N&&(w=Number.MAX_VALUE,N=-Number.MAX_VALUE)
var R=f(void 0!==v?v:$.numThousand,!1),E=l(void 0!==S?S:$.numThousandSep,F,"."===F?",":"."),T=g(void 0!==h?h:$.numPrepend),y=g(void 0!==x?x:$.numAppend),V=b(r,M,F,A,P,R,E,T,y)
return""===V?"0":V}}]).directive("awnum",["dynamicNumberStrategy",U]),X})
